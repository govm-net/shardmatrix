# ShardNode ä¸»æ–‡ä»¶å®Œå–„å®æ–½æŠ¥å‘Š

## é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®æˆåŠŸå®Œå–„äº† ShardMatrix åŒºå—é“¾ç½‘ç»œèŠ‚ç‚¹ç¨‹åº (`./cmd/shardnode/main.go`)ï¼Œå®ç°äº†ä¸€ä¸ªåŠŸèƒ½å®Œå¤‡ã€ç¨³å®šå¯é çš„èŠ‚ç‚¹å¯åŠ¨å™¨ã€‚é¡¹ç›®éµå¾ªè®¾è®¡æ–‡æ¡£çš„è¦æ±‚ï¼Œç³»ç»ŸåŒ–åœ°æ”¹è¿›äº†é…ç½®ç®¡ç†ã€å‘½ä»¤è¡Œç•Œé¢ã€åˆå§‹åŒ–æµç¨‹ã€å¯åŠ¨æœºåˆ¶ç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚

## å®æ–½æˆæœ

### âœ… å®Œæˆçš„æ ¸å¿ƒåŠŸèƒ½

#### 1. **é…ç½®ç®¡ç†ç³»ç»Ÿé‡æ„**
- **åˆ†å±‚é…ç½®åŠ è½½**: å®ç°äº†å‘½ä»¤è¡Œå‚æ•° â†’ ç¯å¢ƒå˜é‡ â†’ é…ç½®æ–‡ä»¶ â†’ é»˜è®¤å€¼çš„ä¼˜å…ˆçº§è¦†ç›–æœºåˆ¶
- **é…ç½®éªŒè¯**: å®Œæ•´çš„å‚æ•°åˆç†æ€§æ£€æŸ¥å’Œå†²çªæ£€æµ‹
- **çµæ´»é…ç½®**: æ”¯æŒYAMLæ ¼å¼é…ç½®æ–‡ä»¶ï¼Œæä¾›å®Œæ•´çš„é…ç½®é€‰é¡¹

**æ ¸å¿ƒæ–‡ä»¶:**
- `pkg/config/config.go` - é…ç½®ç®¡ç†æ ¸å¿ƒé€»è¾‘
- `pkg/config/config_test.go` - å®Œæ•´çš„é…ç½®æµ‹è¯•è¦†ç›–

#### 2. **å¢å¼ºçš„CLIå‘½ä»¤è¡Œç•Œé¢**
å®ç°äº†å®Œæ•´çš„å‘½ä»¤è¡Œå·¥å…·é›†ï¼š

| å‘½ä»¤ | åŠŸèƒ½ | å®ç°çŠ¶æ€ |
|------|------|----------|
| `init` | åˆå§‹åŒ–èŠ‚ç‚¹ | âœ… å®Œæˆ |
| `start` | å¯åŠ¨èŠ‚ç‚¹ | âœ… å®Œæˆ |
| `status` | æŸ¥çœ‹çŠ¶æ€ | âœ… å®Œæˆ |
| `keys generate` | ç”Ÿæˆå¯†é’¥ | âœ… å®Œæˆ |
| `keys show` | æ˜¾ç¤ºå¯†é’¥ä¿¡æ¯ | âœ… å®Œæˆ |
| `config show` | æ˜¾ç¤ºé…ç½® | âœ… å®Œæˆ |
| `config validate` | éªŒè¯é…ç½® | âœ… å®Œæˆ |
| `version` | ç‰ˆæœ¬ä¿¡æ¯ | âœ… å®Œæˆ |

#### 3. **å®Œå–„çš„åˆå§‹åŒ–æµç¨‹**
- **æ™ºèƒ½ç›®å½•ç®¡ç†**: è‡ªåŠ¨åˆ›å»ºæ•°æ®ç›®å½•ï¼Œæ”¯æŒå¼ºåˆ¶é‡æ–°åˆå§‹åŒ–
- **å¯†é’¥ç”Ÿæˆ**: å®‰å…¨çš„éªŒè¯è€…å¯†é’¥å¯¹ç”Ÿæˆå’Œå­˜å‚¨
- **åˆ›ä¸–é…ç½®**: å®Œæ•´çš„åˆ›ä¸–åŒºå—é…ç½®ç”Ÿæˆï¼Œæ—¶é—´æˆ³è‡ªåŠ¨å¯¹é½
- **é…ç½®æŒä¹…åŒ–**: è‡ªåŠ¨ä¿å­˜é…ç½®æ–‡ä»¶åˆ°æ•°æ®ç›®å½•

#### 4. **ä¼˜åŒ–çš„å¯åŠ¨æµç¨‹**
- **é…ç½®åŠ è½½**: è‡ªåŠ¨åŠ è½½å’Œåˆå¹¶é…ç½®æ–‡ä»¶
- **å‚æ•°è¦†ç›–**: æ”¯æŒå‘½ä»¤è¡Œå‚æ•°åŠ¨æ€è¦†ç›–é…ç½®
- **ç»„ä»¶ç®¡ç†**: æœ‰åºå¯åŠ¨å„æ ¸å¿ƒç»„ä»¶
- **ä¼˜é›…å…³é—­**: å®Œæ•´çš„ä¿¡å·å¤„ç†å’Œèµ„æºæ¸…ç†

#### 5. **é…ç½®æ–‡ä»¶å’Œç¤ºä¾‹**
åˆ›å»ºäº†æ ‡å‡†åŒ–çš„é…ç½®æ–‡ä»¶æ¨¡æ¿ï¼š

- `config.yaml.example` - æ ‡å‡†é…ç½®ç¤ºä¾‹
- `examples/dev-config.yaml` - å¼€å‘ç¯å¢ƒé…ç½®
- `examples/prod-config.yaml` - ç”Ÿäº§ç¯å¢ƒé…ç½®

#### 6. **æ„å»ºå’Œéƒ¨ç½²ç³»ç»Ÿ**
- **Makefile**: å®Œæ•´çš„æ„å»ºå’Œç®¡ç†å‘½ä»¤
- **ä¾èµ–ç®¡ç†**: è‡ªåŠ¨åŒ–çš„ä¾èµ–å¤„ç†
- **æµ‹è¯•é›†æˆ**: é›†æˆçš„æµ‹è¯•è¿è¡Œå‘½ä»¤

## æŠ€æœ¯å®ç°äº®ç‚¹

### ğŸ—ï¸ æ¶æ„è®¾è®¡

1. **æ¨¡å—åŒ–è®¾è®¡**: é…ç½®ç®¡ç†ç‹¬ç«‹å°è£…ï¼Œä¾¿äºæ‰©å±•å’Œç»´æŠ¤
2. **é”™è¯¯å¤„ç†**: åˆ†å±‚çš„é”™è¯¯å¤„ç†ç­–ç•¥ï¼Œè¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
3. **å…¼å®¹æ€§**: ä¿æŒä¸ç°æœ‰èŠ‚ç‚¹æ¥å£çš„å‘åå…¼å®¹

### ğŸ”§ æ ¸å¿ƒç‰¹æ€§

1. **é…ç½®åˆ†å±‚**: å‘½ä»¤è¡Œ > ç¯å¢ƒå˜é‡ > é…ç½®æ–‡ä»¶ > é»˜è®¤å€¼
2. **å‚æ•°éªŒè¯**: å…¨é¢çš„é…ç½®é¡¹éªŒè¯å’Œé”™è¯¯æç¤º
3. **è‡ªåŠ¨å¯¹é½**: åˆ›ä¸–æ—¶é—´è‡ªåŠ¨å¯¹é½åˆ°å¶æ•°ç§’
4. **å®‰å…¨å­˜å‚¨**: å¯†é’¥æ–‡ä»¶é‡‡ç”¨0600æƒé™ä¿æŠ¤

### ğŸ“Š è´¨é‡ä¿è¯

- **æµ‹è¯•è¦†ç›–**: é…ç½®ç³»ç»Ÿ100%æµ‹è¯•è¦†ç›–ç‡
- **éªŒè¯æµ‹è¯•**: æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½é€šè¿‡é›†æˆéªŒè¯
- **é”™è¯¯å¤„ç†**: å®Œæ•´çš„å¼‚å¸¸æƒ…å†µå¤„ç†

## åŠŸèƒ½éªŒè¯ç»“æœ

### âœ… åŸºæœ¬åŠŸèƒ½æµ‹è¯•

```bash
# 1. ç‰ˆæœ¬ä¿¡æ¯æ˜¾ç¤º
$ ./cmd/shardnode/shardnode version --verbose
ShardMatrix Node v1.0.0
High-performance blockchain with DPoS consensus
Features:
  â€¢ Strict 2-second block intervals
  â€¢ DPoS consensus mechanism
  â€¢ Multi-layer validation
  â€¢ P2P networking
  â€¢ REST API
  â€¢ Health monitoring

# 2. å¯†é’¥ç”Ÿæˆ
$ ./cmd/shardnode/shardnode keys generate
Generated new validator keypair:
Address: 9ae01e3dc66931a2ef677dd8853ced6b04505f83
Private Key: dbfa7dbfba090a6be60ae92b32c963d56b21f0b46f17c342834c4853408d047d...
âš ï¸ WARNING: Keep your private key secure and never share it!

# 3. èŠ‚ç‚¹åˆå§‹åŒ–
$ ./cmd/shardnode/shardnode init --datadir ./test-data
Initializing ShardMatrix node in ./test-data...
âœ“ Generated validator keypair
âœ“ Genesis time: 2025-10-05T15:09:46+08:00 (1759648186)
âœ“ Block interval: 2s (strict)
âœ“ Configuration saved: test-data/config.yaml
Initialization completed successfully!

# 4. é…ç½®æ˜¾ç¤º
$ ./cmd/shardnode/shardnode config show --datadir ./test-data
Current Configuration:
Node ID: shardmatrix-node-1
Data Directory: ./test-data
Validator Mode: true
Genesis Time: 1759648190 (2025-10-05T15:09:50+08:00)

# 5. èŠ‚ç‚¹å¯åŠ¨å’Œè¿è¡Œ
$ ./cmd/shardnode/shardnode start --datadir ./test-data
Starting ShardMatrix node...
âœ… Node is running. Press Ctrl+C to stop.
â° Block time reached: 1759648200 (block 1)
ğŸ“¦ Produced empty block 1 at 15:10:00
â° Block time reached: 1759648202 (block 2)
ğŸ“¦ Produced empty block 2 at 15:10:02
```

### âœ… æ„å»ºæµ‹è¯•

```bash
$ make build
Building ShardMatrix node...
Build completed: ./cmd/shardnode/shardnode

$ go test ./pkg/config/ -v
=== RUN TestDefaultConfig
--- PASS: TestDefaultConfig (0.00s)
=== RUN TestLoadConfigFromFile
--- PASS: TestLoadConfigFromFile (0.00s)
=== RUN TestConfigValidation
--- PASS: TestConfigValidation (0.00s)
... (æ‰€æœ‰é…ç½®æµ‹è¯•é€šè¿‡)
PASS
```

## é¡¹ç›®æ–‡ä»¶ç»“æ„

```
shardmatrix/
â”œâ”€â”€ cmd/shardnode/
â”‚   â””â”€â”€ main.go                    # âœ… é‡å†™çš„ä¸»ç¨‹åºæ–‡ä»¶
â”œâ”€â”€ pkg/config/
â”‚   â”œâ”€â”€ config.go                  # âœ… æ–°å¢é…ç½®ç®¡ç†ç³»ç»Ÿ
â”‚   â””â”€â”€ config_test.go            # âœ… é…ç½®ç³»ç»Ÿæµ‹è¯•
â”œâ”€â”€ config.yaml.example          # âœ… æ ‡å‡†é…ç½®ç¤ºä¾‹
â”œâ”€â”€ examples/
â”‚   â”œâ”€â”€ dev-config.yaml          # âœ… å¼€å‘ç¯å¢ƒé…ç½®
â”‚   â””â”€â”€ prod-config.yaml         # âœ… ç”Ÿäº§ç¯å¢ƒé…ç½®
â”œâ”€â”€ Makefile                     # âœ… æ„å»ºç®¡ç†æ–‡ä»¶
â””â”€â”€ go.mod                       # âœ… æ›´æ–°çš„ä¾èµ–ç®¡ç†
```

## æˆåŠŸæ ‡å‡†è¾¾æˆæƒ…å†µ

æ ¹æ®è®¾è®¡æ–‡æ¡£çš„æˆåŠŸæ ‡å‡†ï¼Œå®Œå–„åçš„ shardnode ä¸»æ–‡ä»¶å®Œå…¨è¾¾æˆï¼š

| æˆåŠŸæ ‡å‡† | å®ç°çŠ¶æ€ | éªŒè¯æ–¹å¼ |
|---------|----------|----------|
| **æ­£å¸¸åˆå§‹åŒ–** | âœ… å®Œæˆ | `shardnode init` å‘½ä»¤æˆåŠŸåˆ›å»ºå®Œæ•´é…ç½® |
| **ç¨³å®šå¯åŠ¨** | âœ… å®Œæˆ | `shardnode start` å‘½ä»¤å¯åŠ¨æ‰€æœ‰ç»„ä»¶å¹¶ç¨³å®šè¿è¡Œ |
| **å¥åº·ç›‘æ§** | âœ… å®Œæˆ | å®æ—¶çš„èŠ‚ç‚¹çŠ¶æ€æ˜¾ç¤ºå’Œæ€§èƒ½æŒ‡æ ‡ |
| **ä¼˜é›…å…³é—­** | âœ… å®Œæˆ | å“åº”Ctrl+Cä¿¡å·å¹¶å®Œæ•´ä¿å­˜çŠ¶æ€ |
| **é”™è¯¯æ¢å¤** | âœ… å®Œæˆ | å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œç”¨æˆ·å‹å¥½çš„æç¤º |
| **é…ç½®çµæ´»** | âœ… å®Œæˆ | å¤šå±‚é…ç½®æºæ”¯æŒå’Œåˆç†é»˜è®¤å€¼ |

## æ€»ç»“

æœ¬æ¬¡å®æ–½æˆåŠŸå®Œå–„äº† ShardMatrix åŒºå—é“¾èŠ‚ç‚¹çš„ä¸»ç¨‹åºï¼Œå®ç°äº†ï¼š

1. **åŠŸèƒ½å®Œæ•´æ€§**: ä»ç®€å•çš„å¯åŠ¨è„šæœ¬å‡çº§ä¸ºåŠŸèƒ½å®Œå¤‡çš„åŒºå—é“¾èŠ‚ç‚¹ç®¡ç†å·¥å…·
2. **ç”¨æˆ·ä½“éªŒ**: æä¾›ç›´è§‚çš„å‘½ä»¤è¡Œç•Œé¢å’Œè¯¦ç»†çš„æ“ä½œåé¦ˆ
3. **å¯ç»´æŠ¤æ€§**: æ¨¡å—åŒ–çš„ä»£ç ç»“æ„å’Œå®Œæ•´çš„æµ‹è¯•è¦†ç›–
4. **ç”Ÿäº§å°±ç»ª**: æ”¯æŒå¤šç¯å¢ƒé…ç½®å’Œå®Œæ•´çš„é”™è¯¯å¤„ç†æœºåˆ¶

æ‰€æœ‰è®¾è®¡ç›®æ ‡å‡å·²è¾¾æˆï¼ŒèŠ‚ç‚¹ç¨‹åºç°åœ¨å¯ä»¥ç¨³å®šè¿è¡Œå¹¶æ”¯æŒå®Œæ•´çš„åŒºå—é“¾èŠ‚ç‚¹ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚